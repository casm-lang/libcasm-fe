
Specification
: CASM Definitions

Definition
: FunctionDefinition
| DerivedDefinition
| RuleDefinition
| EnumerationDefinition

Definitions
: Definitions Definition
| Definition

FunctionDefinition
: FUNCTION MaybeFunctionAttributes Identifier COLON MaybeFunctionParameters ARROW Type MaybeDefined MaybeInitially
| ProgramFunctionDefinition

MaybeInitially
: INITIALLY LCURPAREN MaybeInitializers RCURPAREN
| %empty

MaybeDefined
: DEFINED LCURPAREN Expression RCURPAREN
| %empty

FunctionParameters
: FunctionParameters ASTERIX Type
| Type

MaybeFunctionParameters
: FunctionParameters
| %empty

MaybeFunctionAttributes
: LPAREN MaybeIdentifiers RPAREN
| %empty

ProgramFunctionDefinition
: INIT Identifier
| INIT LCURPAREN MaybeInitializers RCURPAREN

Initializer
: Expression
| Expression ARROW Expression
| Arguments ARROW Expression

Initializers
: Initializers COMMA Initializer
| Initializer

MaybeInitializers
: Initializers
| %empty

DerivedDefinition
: DERIVED Identifier MaybeParameters ARROW Type EQUAL Expression

EnumerationDefinition
: ENUM Identifier EQUAL LCURPAREN Identifiers RCURPAREN

Identifier
: IDENTIFIER

Identifiers
: Identifiers COMMA Identifier
| Identifier

MaybeIdentifiers
: Identifiers
| %empty

Variable
: Identifier COLON Type
| Identifier

Parameters
: Parameters COMMA Variable
| Variable

MaybeParameters
: LPAREN Parameters RPAREN
| %empty

Type
: BasicType
| ComposedType
| FixedSizedType
| RangedType

BasicType
: Identifier

ComposedType
: Identifier LPAREN Types RPAREN

FixedSizedType
: Identifier LESSER Expression GREATER

RangedType
: Identifier LESSER Expression DOTDOT Expression GREATER

Types
: Types COMMA Type
| Type

Atom
: RuleReference
| BitNumber
| IntegerNumber
| FloatingNumber
| RationalNumber
| String
| Undefined
| Boolean

Undefined
: UNDEF

Boolean
: TRUE
| FALSE

String
: STRING

BitNumber
: BINARY
| HEXADECIMAL

IntegerNumber
: INTEGER

FloatingNumber
: FLOATING

RationalNumber
: RATIONAL

RuleReference
: AT IDENTIFIER

Term
: DirectCallExpression
| IndirectCallExpression
| ConditionalExpression
| UniversalQuantifierExpression
| ExistentialQuantifierExpression
| Expression
| List
| Range
| Atom

Expression
: LPAREN Expression RPAREN
| PLUS Term %prec UPLUS
| LPAREN Term RPAREN
| MINUS Term %prec UMINUS
| Term PLUS Term
| Expression MINUS Expression
| Expression ASTERIX Expression
| Expression SLASH Expression
| Expression PERCENT Expression
| Expression CARET Expression
| Expression NEQUAL Expression
| Expression EQUAL Expression
| Expression LESSER Expression
| Expression GREATER Expression
| Expression LESSEQ Expression
| Expression GREATEREQ Expression
| Expression OR Expression
| Expression XOR Expression
| Expression AND Expression
| Expression IMPLIES Expression
| NOT Expression

Range
: LSQPAREN Term DOTDOT Term RSQPAREN

List
: LSQPAREN RSQPAREN
| LSQPAREN Term RSQPAREN
| LSQPAREN Terms RSQPAREN

Terms
: Terms Term COMMA
| Term COMMA

Arguments
: LPAREN Terms RPAREN
| LPAREN RPAREN

DirectCallExpression
: Identifier %prec DIRECT_CALL_EXPR_NO_ARG
| Identifier Arguments

IndirectCallExpression
: LPAREN ASTERIX Term RPAREN Arguments

ConditionalExpression
: IF Expression THEN Expression ELSE Expression

UniversalQuantifierExpression
: FORALL Variable IN Expression HOLDS Expression

ExistentialQuantifierExpression
: EXISTS Variable IN Expression WITH Expression

RuleDefinition
: RULE Identifier MaybeParameters EQUAL Rule
| RULE Identifier MaybeParameters ARROW Type EQUAL Rule

Rule
: SkipRule
| ConditionalRule
| CaseRule
| LetRule
| ForallRule
| IterateRule
| BlockRule
| SequenceRule
| UpdateRule
| CallRule

Rules
: Rules Rule
| Rule

SkipRule
: SKIP

ConditionalRule
: IF Expression THEN Rule
| IF Expression THEN Rule ELSE Rule

CaseRule
: CASE Expression OF LCURPAREN CaseLabels RCURPAREN

CaseLabel
: DEFAULT COLON Rule
| UNDERLINE COLON Rule
| Expression COLON Rule

CaseLabels
: CaseLabel CaseLabels
| CaseLabel

LetRule
: LET Variable EQUAL Expression IN Rule

ForallRule
: FORALL Variable IN Expression DO Rule

IterateRule
: ITERATE Rule

BlockRule
: LCURPAREN Rules RCURPAREN
| PAR Rules ENDPAR

SequenceRule
: SEQ_BRACKET Rules ENDSEQ_BRACKET
| SEQ Rules ENDSEQ

UpdateRule
: DirectCallExpression UPDATE Expression

CallRule
: CALL DirectCallExpression
| DirectCallExpression
| CALL IndirectCallExpression
| IndirectCallExpression
