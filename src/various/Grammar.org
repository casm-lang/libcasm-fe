
Specification
: CASM Definitions

Definition
: FunctionDefinition
| DerivedDefinition
| RuleDefinition
| EnumerationDefinition

Definitions
: Definitions Definition
| Definition

FunctionDefinition
: FUNCTION MaybeFunctionAttributes Identifier COLON MaybeFunctionParameters ARROW Type MaybeDefined MaybeInitially
| ProgramFunctionDefinition

MaybeInitially
: INITIALLY LCURPAREN MaybeInitializers RCURPAREN
| %empty

MaybeDefined
: DEFINED LCURPAREN Atom RCURPAREN
| %empty

FunctionParameters
: FunctionParameters STAR Type
| Type

MaybeFunctionParameters
: FunctionParameters
| %empty

MaybeFunctionAttributes
: LPAREN MaybeIdentifiers RPAREN
| %empty

ProgramFunctionDefinition
: INIT RuleReference
| INIT LCURPAREN MaybeInitializers RCURPAREN

Initializer
: Atom
| MaybeArguments ARROW Atom

Initializers
: Initializers COMMA Initializer
| Initializer

MaybeInitializers
: Initializers
| Initializers COMMA
| %empty

DerivedDefinition
: DERIVED Identifier MaybeParameters COLON Type EQUAL Expression

EnumerationDefinition
: ENUM Identifier EQUAL LCURPAREN MaybeIdentifiers RCURPAREN

Identifier
: IDENTIFIER

Identifiers
: Identifiers COMMA Identifier
| Identifier

MaybeIdentifiers
: Identifiers
| Identifiers COMMA
| %empty

Variable
: Identifier COLON Type

Parameters
: Parameters COMMA Variable
| Variable

MaybeParameters
: LPAREN Parameters RPAREN
| LPAREN RPAREN
| %empty

Type
: BasicType
| ComposedType
| StaticallySizedType
| RangedType

BasicType
: Identifier

ComposedType
: Identifier LPAREN Types RPAREN

StaticallySizedType
: Identifier LPAREN Atom RPAREN

RangedType
: Identifier LPAREN Atom DOTDOT Atom RPAREN

Types
: Types COMMA Type
| Type

Atom
: DirectCallExpression
| IndirectCallExpression
| LPAREN Expression RPAREN
| PLUS LPAREN Expression RPAREN %prec UPLUS
| MINUS LPAREN Expression RPAREN %prec UMINUS
| RuleReference
| IntegerNumber
| FloatingNumber
| RationalNumber
| String
| List
| Range
| Undefined
| Boolean

Undefined
: UNDEF

Boolean
: TRUE
| FALSE

String
: STRCONST

IntegerNumber
: INTEGERCONST

FloatingNumber
: FLOATINGCONST

RationalNumber
: RATIONALCONST

RuleReference
: AT IDENTIFIER

Range
: LSQPAREN Atom DOTDOT Atom RSQPAREN

List
: LSQPAREN MaybeExpressions RSQPAREN

Expression
: Expression PLUS Expression
| Expression MINUS Expression
| Expression STAR Expression
| Expression SLASH Expression
| Expression PERCENT Expression
| Expression NEQUAL Expression
| Expression EQUAL Expression
| Expression LESSER Expression
| Expression GREATER Expression
| Expression LESSEQ Expression
| Expression GREATEREQ Expression
| Expression OR Expression
| Expression XOR Expression
| Expression AND Expression
| NOT Expression
| Atom

Expressions
: Expressions COMMA Expression
| Expression

MaybeExpressions
: Expressions
| Expressions COMMA
| %empty

Arguments
: LPAREN Expressions RPAREN
| LPAREN RPAREN

MaybeArguments
: Arguments
| Expression
| %empty

DirectCallExpression
: Identifier MaybeArguments

IndirectCallExpression
: LPAREN Expression RPAREN Arguments

RuleDefinition
: RULE Identifier MaybeParameters EQUAL Rule

Rule
: SkipRule
| ConditionalRule
| CaseRule
| LetRule
| ForallRule
| IterateRule
| BlockRule
| SequenceRule
| UpdateRule
| CallRule

Rules
: Rules Rule
| Rule

SkipRule
: SKIP

ConditionalRule
: IF Expression THEN Rule
| IF Expression THEN Rule ELSE Rule

CaseRule
: CASE Expression OF LCURPAREN CaseLabels RCURPAREN

CaseLabel
: DEFAULT COLON Rule
| UNDERLINE COLON Rule
| Atom COLON Rule

CaseLabels
: CaseLabel CaseLabels
| CaseLabel

LetRule
: LET Variable EQUAL Expression IN Rule

ForallRule
: FORALL Variable IN Expression DO Rule

IterateRule
: ITERATE Rule

BlockRule
: LCURPAREN Rules RCURPAREN
| PAR Rules ENDPAR

SequenceRule
: SEQ_BRACKET Rules ENDSEQ_BRACKET
| SEQ Rules ENDSEQ

UpdateRule
: DirectCallExpression UPDATE Expression

CallRule
: CALL DirectCallExpression
| DirectCallExpression
| CALL IndirectCallExpression
| IndirectCallExpression
